# 코드리뷰

## 효율적 PR 방법
- **지루한 작업은 컴퓨터로 처리**
    - ex) Formatting Tool
- **PR을 올릴 때 주석 달기**
    - 리뷰어들을 위한 설명을 코멘트로 남겨서 리뷰어들의 시간을 절약할 수 있게 하라
    - ex) 여기에  xxx를 삽입해도 괜찮은지 궁금합니다
- **리뷰어에 많은 사람들을 추가하라**
    - 많은 사람들이 본다는 것을 알면 사람들은 대개 더 잘 하려는 경향이 있다

## 효율적 리뷰 방법

- **리뷰는 즉시 시작**
    - 코드리뷰를 높은 우선순위로
        - 저자는 리뷰 종료될 때까지 대기함
    - 리뷰를 바로 시작하면 선순환됨
        - 코드를 읽고 피드백을 줄 때는 시간을 가지고 진행해도 되지만 시작은 바로 해라
        - 이상적으로는 수분 내에
    - 리뷰 라운드의 최대 시간은 하루
        - 우선순위 높은 업무로 1일 내 불가하면 다른 리뷰어 지정
        - 월 1회 이상 재지정을 해야한다면 속도를 줄여서 건강한 개발 관습(Practices)를 유지할 수 있어야함
    - PR의 Size와 Complexity가 중요
        - 작고, 범위가 좋은 PR → 쉽고 상쾌하게 리뷰하기 좋음 → 빠르게 리뷰 수행
    - PR Size
        - LOC : 코드 라인?
        - ex) 1,000 LOC Feature
            - 200 LOC 리뷰에 2시간 소요 가정
                - 200 LOC로 Feature를 분리해서 5번 PR → 10시간 소요 → 1~2일에 리뷰 완료가 바람직
            - LOC에 무관하게 1일 소요된다면
                - Review에 5일 즉 1주일 소요(200 LOC/D)
                - 1주일 동안 대기 원치 않으므로 500~600 LOC를 보내게 됨
                - 리뷰 코스트 증가. 품질 낮은 피드백 유발(200 LOC보다 600 LOC가 집중하기 어려우므로)
- **고수준으로 시작, 저수준으로 내려가라**
    - 리뷰 라운드에서 많은 의견을 남길 수록, 저자가 당황할 위험 커짐
    - 하나의 라운드에 20~50개 정도의 의견은 위험의 시작
    - 초기 라운드에서는 고수준 피드백으로 제한
        - 버그, 장애, 성능, 보안 등
        - Extract Method, Compsed Method 등
    - 고수준의 피드백이 처리된 후에 저수준 이슈를 처리
        - (선택적인) 설계 개선
        - 변수명 변경, 주석을 명확하게 하는 것, Invert-if(복잡도) 등
- **예제 코드 제공에 관대해라**
    - 저자를 기분 좋게 하기 위한 방법
        - 리뷰 중에 선물 주기(코드 예제)
        - 너무 긴 예제는 관대한 것이 아니라 억압적으로 보임
    - 라운드당 2~3개의 코드 예제로 제한
        - 모든 PR에 예제를 제공하면 저자가 코드를 작성할 수 없다고 생각한다는 신호
- **리뷰의 범위를 존중하라**
    - 자주 보이는 Anti-Pattern
        - PR 근처의 코드를 보고 저자에게 수정을 요청
        - 리뷰의 범위가 아니면 수정하라고 하지 말자
        - 예외) 하지만 PR이 둘러싼 코드에 영향을 미칠 떄는 가능
- **태그를 활용**
    - 산(mountain) : 커멘트가 처리될 때까지 블록 됨
    - 바위(boulder) : 블록 됨, 하지만 계속 리뷰 진행은 가능
    - 암성(rock) : 블록 되지 않지만 이후 작업이 요구됨
    - 자갈(pebble) : 블록 되지 않고, 이후에 고려가 필요함
    - 모래(sane) : 블록 되지 않고, 방여하던지 안 하던지는 저자의 자유
    - Nit : 고치면 좋지만 아니어도 그만
        - 그래도 보통 고침
        - 리뷰어는 항상 더 개선할 수 있는 의견을 자유롭게 남길 수 있어야 함
        - 중요치 않다면 “Nit”를 태그로 남겨서 저자가 무시할 수 있도록 할 수 있음
        - 리뷰어가 “Nit”로 태깅하는 것은 저자들이 반드시 수정하지는 않아도 됨을 의미
        - 교육적인 목적이나 개발자들이 지속적으로 기술을 연마하는 것을 돕는 목적
        - ex) “nit : null 대신 Optional을 쓰면 어떨까요?”
- **1~2 등급만 코드 레벨을 올리는 것을 목표로**
    - D 등급의 PR을 받으면 저자가 C나 B 등급을 받도록 도와라
        - 완전하지는 않아도 충분히 좋은 코드가 되도록
    - F : 기능적으로 틀렸거나, 너무 복잡해서 정합성에 확신이 없는 상태
    - 승인을 보류하는 유일한 이유
        - 수 차례의 리뷰 라운드 후에도 코드가 F 상태인 경우

## 피드백 방법

- **절대 “너”라고 하지 마라**
    - 
- **건설적인 피드백을 하라**
    - 동료들 간의 코드 리뷰
        - 경쟁 유발이 아닌 팀의 생산성을 높이는 것
    - 코드 리뷰를 자신의 코드에 대한 비판이 아니라 학습의 과정으로 인지하면 전체적인 프로젝트의 성공에 기여함
    - 건설적인 피드백은 개발자들이 그들의 실수에서 배우고 역량을 증대하도록 동기부여함
- **진정한 칭찬을 해라**
    - 대부분의 리뷰어가 잘못된 부분에만 집중
        - 하지만 리뷰는 긍정적 행위 강화를 위한 값진 기회이기도 함
        - PR에서 좋은 변경이 있으면 칭찬하라
    - 저자가 주니어 혹은 신규 입사자라면 리뷰에 매우 민감하고 방어적일 수 있음
    - 진신어린 칭찬은 리뷰어가 잔인한 감시자가 아니라 도와주려는 팀 동료라는 것을 보여서 이런 긴장감을 낮춤
- **피드백은 명령이 아니라 요청으로 표현해라**
    - 일상에서 동료에게 명령하지 않는다. 하지만 리뷰에서는 강압적인 명령이 종종 발견 된다.
- **의견이 아니라 원칙에 기반하여 피드백하라**
    - 저자에게 의견을 줄 때는 “제안하는 변경”과 “변경의 이유”를 모두 설명하라
        - ex) “이 클래스를 2개로 분리해야 해요”
        - → 지금 이 클래스는 파일 다운로드와 파싱의 2가지 책임을 가지고 있어요. 라운로더와 파서 2개의 클래스로 분리하여 SRP를 준수하는 것이 어떨까요?
    - 항상 원칙에 기반하여 정확히 뭐가 잘못 되었는지 언급할 수 있는 것은 아니다
        - ex) 이 코드는 혼란스럽네요 → 나는 이 코드를 이해하기 어렵네요
- **반복적인 패턴에 대해서 피드백을 제한하라**
    - 저자의 실수가 동일한 패턴임을 식별 했다면 모든 경우를 언급하지 말라, 동일 패턴에 대해서 2~3개 정도의 예를 언급하라
- **교착상태를 적극적으로 처리해라**
    - 교착상태로 향하는지 나타내는 표식
        - 토론의 톤이 점차 팽팽해지고 공격적으로 됨
        - 라운드당 커멘트가 줄어들지 않는 경향을 보임
        - 너무 많은 커멘트에 저항이 보임
    - 코드 리뷰의 최악의 결과는 교착상태(Stalemate)
        - 커멘트를 반영하지 않으니 승인 거부
        - 저자는 커멘트 반영을 거부
    - 만나서 얘기하라
        - 화상 혹은 만나서 논의
        - 텍스트 기반의 의사소통은 상대가 인간이라는 것을 잊게 함
    - 인정하거나 Escalate하라
        - 교착상태가 길어지면 관계가 나빠짐(퇴사)
        - 그냥 승인해줘라
    - 인정이 불가한 경우
        - 저자에게 논의를 팀장이나 테크 리더에게 Escalation 권유
        - 다른 리뷰어에게 할당을 권유
    - 교착상태로 부터 회복
        - 상황을 관리자와 논의하라
        - 휴식을 가져라. 가능하다면 안정될 때까지 PR을 서로 보내지 마라
        - 갈등 해결책을 학습하라
    - 설계 리뷰를 고려하라
        - 코드 리뷰 때 설계 리뷰 때 노의되었어야 할 사항을 논쟁하는가?
        - 설계 리뷰는 있었나?
    - 아주 심각하지 않다면 그냥 인정하고 좋은 관계로 동료와의 협업을 지속해라

## 체크 리스트

### 버그/장애

- NPE
- Thread ZSafety
- OOM
- 단위 테스트 없는 중요 로직
- 경계값 테스트
- 외부 URL이나 DB를 n번 호출하는 경우

### 기능성

- 코드가 실제 기대되는 일을 하는지?
- 미묘한 버그가 없는지?
- 선택한 해결책이 요구사항에 적합한지?

### 가독성 / 유지보수 용이성

- Formatting / Style
- Name
- Magic Number
- Null을 반환하는지?
- Bollean나 Nullable 파라미터로 분기하는지?
- 읽어서 코드가 이해되는지? 예외 메시지는 이해 가능한지?
- 테스트가 Happy pahts와 Exceptional cases를 모두 다르는지?

### 테스트

- 새로운 / 변경된 코드에 대한 테스트가 존재하는가
- 테스트가 하는 일을 이해할 수 있나?
- 테스트가 요구사항과 매치되는지
- 기존의 테스트들이 커버하지 못하는 테스트를 생각해 낼 수 있는지
- 한계를 문서화 하고 있는 테스트가 있는지
    - 배치가 한번에 1,000개의 항목만 처리 가능한 경우에 1,000개를 초과하면 예외를 발생시키는 테스트가 존재하는지

### 자료구조

- 너무 많은 탐색이 있는지
- 잦은 정렬이 있는지
- Map을 전역 상수로 제공하는지
- Map이 키로 사용된다면 equals, hashCode가 구현되어있는지
- Set을 사용한다면 equals, hashCode가 구현되어있는지, TreeSet이면 Comparable이 구현되어있는지

### 성능

- 변경 사항이 성능 저하를 유발하는지?
- DB 호출, NW 호출이 많은지?
- 리소스를 효율적/효과적으로 사용하는지?
- Reflection은 최소한으로 사용

### 보안

### 설계

- SRP를 준수하며 Coupling, Cohesion을 준수하는지
- 고수준 컴포넌트가 저수준 컴포넌트에게 의존하는지(DIP)
- 기능 확장을 코드 수정없이 할 수 있는지
